<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title></title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js'></script>
    <script src='https://api.tiles.mapbox.com/mapbox.js/plugins/turf/v2.0.2/turf.min.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin:0; padding:0; }
        #map { width:100%;height:800px; }

        .start {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: purple;
            color: #fff;
            display: inline-block;
            margin: 0;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            border-radius: 3px;
            z-index:20;
        }
    </style>
</head>
<body>
<div id='map'>
    <button id="start" class="start">START</button>
</div>
<script>
    var coordinates = [[126.9206824,37.5911699],[126.9206824,37.5911699],[126.92136561,37.58966975],[126.92109083,37.58952302],[126.92055373,37.58967273],[126.91988659,37.5896076],[126.91962307,37.58933807],[126.9191608,37.58882023],[126.91910822,37.5887736],[126.91910157,37.58867057],[126.91911371,37.58868463],[126.91864267,37.58901266],[126.91772885,37.58971363],[126.91745573,37.58991341],[126.91707991,37.58957035],[126.91674638,37.58827906],[126.91638708,37.58726457],[126.91560564,37.58641614],[126.91469728,37.58525918],[126.91384838,37.58395511],[126.91345182,37.58317844],[126.91329928,37.5828243],[126.91331483,37.5828144],[126.91331483,37.5828144],[126.91331483,37.5828144],[126.91331483,37.5828144],[126.91331483,37.5828144],[126.91331483,37.5828144],[126.91334217,37.58264868],[126.91258945,37.58171652],[126.91252808,37.58160437],[126.91176982,37.58058925],[126.91118195,37.57984731],[126.91056676,37.57907467],[126.91001937,37.57829617],[126.91001934,37.57828457],[126.91007149,37.5782744],[126.91006321,37.57826846],[126.91005948,37.57827035],[126.91005691,37.57826844],[126.91005964,37.57826946],[126.91005951,37.57826946],[126.91006386,37.5782707],[126.90996233,37.57807776],[126.90912291,37.57732184],[126.90816821,37.57643804],[126.90745249,37.57569946],[126.90740362,37.57565046],[126.90740353,37.57565047],[126.90726251,37.57548735],[126.9065639,37.57487049],[126.90624769,37.57455345],[126.9062701,37.57456412],[126.9062701,37.57456412],[126.9062701,37.57456412],[126.90627774,37.57457642],[126.90607881,37.57438506],[126.90662083,37.57357988],[126.90741411,37.57296858],[126.90761015,37.57277754],[126.90761015,37.57277754],[126.90761009,37.5727776],[126.90761009,37.5727776],[126.90761009,37.5727776],[126.90761009,37.5727776],[126.90780165,37.57261897],[126.90839802,37.57229091],[126.90932813,37.57185811],[126.90932813,37.57185811],[126.91038296,37.5713573],[126.91150266,37.57079885],[126.91150266,37.57079885],[126.91280101,37.57014181],[126.91379744,37.56964843],[126.91483619,37.56916113],[126.91603537,37.5686176],[126.91623615,37.56853437],[126.91623608,37.5685344],[126.91623608,37.5685344],[126.91623608,37.5685344],[126.91623608,37.5685344],[126.91633823,37.56848174],[126.91724765,37.56799601],[126.91844589,37.5673591],[126.91977867,37.56686298],[126.92088041,37.56665161],[126.92104138,37.5666193],[126.92104138,37.5666193],[126.92119793,37.56658898],[126.92218832,37.56642574],[126.92365386,37.56624493],[126.9247064,37.56621347],[126.92486774,37.56621136],[126.92486774,37.56621136],[126.92486774,37.56621136],[126.92487172,37.56622202],[126.92507792,37.56622357],[126.92579832,37.56618685],[126.92589747,37.56617851],[126.92681038,37.56598008],[126.9280485,37.56533446],[126.92865626,37.56436745],[126.92834576,37.56342594],[126.92781053,37.56271398],[126.92777783,37.56267786],[126.92777783,37.56267786],[126.92777783,37.56267786],[126.92777783,37.56267786],[126.92777783,37.56267786],[126.92777783,37.56267786],[126.92773861,37.56261869],[126.92732818,37.56200963],[126.9268789,37.56135933],[126.92668571,37.56029043],[126.92665854,37.55988877],[126.9266508,37.55977246],[126.9266796,37.55918101],[126.92721468,37.55851977],[126.92847823,37.55806585],[126.93014279,37.55739916],[126.93099501,37.55706865],[126.93119099,37.55699379],[126.93119099,37.55699379],[126.93119095,37.55699382],[126.93119095,37.55699382],[126.93120574,37.55700763],[126.93203622,37.55670422],[126.93337585,37.55624532],[126.93402975,37.55601401],[126.93409728,37.55599875],[126.93487885,37.55575212],[126.93566088,37.55548985],[126.93619081,37.55531533],[126.93690943,37.5547876],[126.93704236,37.55382833],[126.93722439,37.55271658],[126.93752296,37.5515585],[126.93814796,37.55028589],[126.93880791,37.54934316],[126.93969059,37.54882147],[126.94030773,37.54855261],[126.94040662,37.54851337],[126.94042251,37.54850849],[126.94042251,37.54850849],[126.94042249,37.54850849],[126.94042249,37.54850849],[126.94042249,37.54850849],[126.94042249,37.54850849],[126.94042249,37.54850849],[126.94042249,37.54850849],[126.94042249,37.54850849],[126.94069107,37.54836507],[126.94145262,37.54808244],[126.94152503,37.54804573],[126.94152503,37.54804573],[126.94152503,37.54804573],[126.94152503,37.54804573],[126.94152503,37.54804573],[126.94152503,37.54804573],[126.94152503,37.54804573],[126.94152503,37.54804573],[126.94152503,37.54804573],[126.94152503,37.54804573],[126.9417903,37.54798451],[126.94281227,37.54753849],[126.94419052,37.54691924],[126.94419052,37.54691924],[126.94570236,37.54631762],[126.94698677,37.5457311],[126.94766453,37.54538635],[126.94771439,37.54538072],[126.94771439,37.54538072],[126.94771439,37.54538072],[126.94802013,37.54524739],[126.9486517,37.544927],[126.94877495,37.54486578],[126.94877495,37.54486578],[126.94877495,37.54486578],[126.94893817,37.54478343],[126.94955351,37.54455596],[126.94983684,37.544512],[126.94983683,37.54451201],[126.94983683,37.54451201],[126.94983683,37.54451201],[126.94983683,37.54451201],[126.94983683,37.54451201],[126.95053131,37.54435042],[126.95162234,37.54378234],[126.95269013,37.54327579],[126.9525829,37.5431592],[126.95360839,37.54286617],[126.95363818,37.5428746],[126.95369111,37.54286944],[126.95406131,37.54279854],[126.95327899,37.54317107],[126.95328612,37.54354515],[126.95312641,37.54361842],[126.9529388,37.543407]];
    var audioSource = 'http://ttamna-api.hlabpartner.com/public/music/1/crush.mp3';
    var mapStyle = 'mapbox://styles/kjhwert/ckh44po6e0ex919qohozaqs33';

    mapboxgl.accessToken = 'pk.eyJ1Ijoia2pod2VydCIsImEiOiJja2g0M2s5Mm8wYXU4MnNvYWh0Nzc1ZXhyIn0.plvnGOmcjL1bMP2P7vuSTg';
    var map = new mapboxgl.Map({
        container: 'map',
        style: mapStyle,
        center: coordinates[0],
        pitch: 60, // pitch in degrees
        bearing: -60, // bearing in degrees
        zoom: 17
    });
    var iPath = turf.linestring(coordinates);
    var geojson = {
        'type': 'FeatureCollection',
        'features': [
            {
                'type': 'Feature',
                'geometry': {
                    'type': 'LineString',
                    'coordinates': []
                }
            }
        ]
    };
    var iPathLength = turf.lineDistance(iPath, 'kilometers');
    var iPoint = turf.along(iPath, 0, 'miles');
    map.on('load', function () {
        map.addSource("path", {
            "type": "geojson",
            "data": iPath,
            "maxzoom": 20
        });
        map.addSource('line', {
            'type': 'geojson',
            'data': geojson
        });
        // add the line which will be modified in the animation
        map.addLayer({
            'id': 'line-animation',
            'type': 'line',
            'source': 'line',
            'layout': {
                'line-cap': 'round',
                'line-join': 'round'
            },
            'paint': {
                'line-color': '#007bf1',
                'line-width': 8,
                'line-opacity': 0.8
            }
        });

        map.addSource('point', {
            'type': 'geojson',
            'data': iPoint
        });

        function animate () {
            document.querySelector('.start').style.display = 'none';
            var audio = new Audio();
            audio.src = audioSource;
            audio.play();
            /**
             * step : interval count
             * numSteps : max interval count.
             *    if step === numSteps || coordinates is end => interval end
             * timePerStep : interval time
             * */
            var step = 0;
            var numSteps = 500; //Change this to set animation resolution
            var timePerStep = 30; //Change this to alter animation speed.
            var pSource = map.getSource('point');
            var interval = setInterval(function() {
                step += 1;

                var curDistance = step / numSteps * iPathLength;

                var iPoint = turf.along(iPath, curDistance, 'miles');

                /** End Animation */
                if (iPoint.geometry.coordinates === coordinates[coordinates.length - 1]) {
                    map.fitBounds([
                        coordinates[0], iPoint.geometry.coordinates
                    ]);
                    audio.pause();
                    setTimeout(() => {
                        document.querySelector('.start').style.display = 'block';
                    }, 2000)
                    return clearInterval(interval);
                }

                map.jumpTo({center:iPoint.geometry.coordinates})
                geojson.features[0].geometry.coordinates.push(iPoint.geometry.coordinates);
                map.getSource('line').setData(geojson);
                pSource.setData(iPoint);

            }, timePerStep);
        }

        document.getElementById('start').addEventListener('click', function () {
            animate()
        })
    });
</script>
</body>
</html>
